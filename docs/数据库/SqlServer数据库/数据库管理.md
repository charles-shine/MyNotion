# 数据库管理

## T-SQL语言

>  SQL（Structured Query Language,结构化查询语言），最常用的最为广泛的关系数据库查询语言。

T-SQL语言由微软开发，是一种非过程化语言，可单独执行，直接操作数据库，也可以嵌入其他语言中执行。

主要由五部分组成：

- 数据库定义语言（Data Definition Language，DDL）：包含用于定义和管理数据库以及数据库中各中对象的语句。
- 数据操纵语言（Data Manipulation Language，DML）：包含了用于查询、添加、修改和删除数据库中数据的语句。
- 数据控制语言（Data Control Language，DCL）：包含了用于设置或更改数据库用户或角色权限的语句。
- 系统存储过程（System Stored Procedure）：用于方便的从系统表中查询信息，或者完成与更新数据库表相关的管理任务或其他的系统管理任务。存放于master数据库中，可以在任意数据库中执行，以sp _ 或xp _ 开头。

- 其他语言元素

  为了编程需要，T-SQL增加了一些其他语言元素。

## 标识符

**格式规则**：

1. 长度不超过128字符。
2. 开头字母为a-z或A-Z、#、_、@以及来自其他语言的字母字符。
3. 后续字符可以是a-z或A-Z、#、_、@以及来自其他语言的字母字符。
4. **不允许嵌入空格或者其他特殊字符**。
5. 不允许与保留字同名。

> 以@或#开头的标识符具有特殊的含义，@开头表示变量、@@开头表示全局变量、#表示临时表或过程、##表示全局临时对象

## 数据库组成

### 文件

根据存储信息不同，数据库中文件可分为三类：

1. 主数据库文件（Primary Database file）：**每个数据库有且只有一个主数据库文件**，主数据库文件用来存储数据库的启动信息以及部分或全部数据。**文件扩展名为mdf**。
2. 次数据库文件（Secondary Database File）：**一个数据库可以没有或有多个次数据库文件**，用于存储主数据库未存储的剩余数据和数据库对象。**文件扩展名为ndf**。
3. 事务日志文件（Transaction Log File）：**一个数据库可以有一个或有多个事务日志文件**。用于存储数据库的更新情况等事务日志信息，在数据库损坏时，可以使用事务日志文件恢复数据库。**文件扩展名为ldf**。

### 文件组

为便于分配和管理，SQL Server允许将多个文件归档为同一组，并赋予此组一个名称，这就是文件组。

1. 主文件组（Primary File Group）：**所有数据库有且仅有一个主文件组**，包含了所有的系统表，包含主数据库文件和未指定组的其他文件。
2. 次文件组（Secondary File Group）：**数据库可以没有或包含多个用户定义的文件组，或称次文件组**。包含次数据库文件。
3. 默认文件组：**每个数据库都仅有一个文件组作为默认文件组运行**。可以由用户指定，缺省时为主文件组。

### 数据库中文件与文件组的关系图

![hNHHR.png](https://s1.328888.xyz/2022/05/06/hNHHR.png)

## 创建数据库

### create database语句创建数据库

```sql
create database 数据库名
[on primary
    {<文件说明>[,...n]}
]
[<文件说明>[,...n]]
[log on
    {<文件说明>[,...n]}
]
```

<文件说明>：

（

name=逻辑文件名，

filename=‘物理文件名’，

size=初始大小，

maxsize={最大限制|unlimited}，

filegrowth=增长量（固定大小或百分比）

）[,...n]

<文件组>：

filegroup文件组名称<文件说明>[,...n]

> 日志文件如果不创建，系统会自动生成大小为数据库大小的25%。

> 一般将数据文件与日志文件存储在不同的物理磁盘上

### 查看数据库

```sql
sp_helpdb 数据库名称
```

### alter database语句修改数据库

```sql
alter database 数据库名称
{add file<文件说明>[,...n]
	[to filegroup 文件组名称]
|add log file<文件说明>[,...n]
|remove file 逻辑文件名
|add filegroup 文件组名称
|remove filegroup 文件组名称
|modify file<文件说明>
|modify name=新数据库名
|modify filegroup 文件组名称{文件组属性|name = 新文件组名称}
}
```

注：modify file指定大小时，新的大小必须比文件当前大小还大。

文件组属性：

1. readonly——指定文件组为只读；不允许更新其中的对象；主文件组不能设置为只读。
2. readwrite——指定文件组为读写属性；允许更新文件组中的对象。
3. default——将文件组指定为默认文件组。

## 删除数据库

```sql
drop databse 数据库名称
```

