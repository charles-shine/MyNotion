#  表的管理

## SQL server的数据类型

### 整型数据类型

| 数据类型 | 字长 | 是否能存储正负数 | 存储范围                            |
| :------- | ---- | ---------------- | ----------------------------------- |
| bingint  | 8    | 能               | -2<sup>63</sup> 到2<sup>63</sup> -1 |
| int      | 4    | 能               | -2<sup>31</sup> 到2<sup>31</sup> -1 |
| smallint | 2    | 能               | -2<sup>15</sup> 到2<sup>15</sup>-1  |
| tinyint  | 1    | 否               | 0到255                              |



### 定点数据类型

用于表示定点实数，包括numeric和decimal类型，*Numeric类型等价于decimal类型*。**存储范围：-10<sup>38</sup> -1到10<sup>38</sup>的固定精度和范围**。使用时必须指定范围和精度（范围指总位数，而精度指小数点后面的位数）。

格式：decimal[(p[,s])]

​			numeric[(p[,s])]

参数说明：p:精度，指明小数点左边和右边的最大位数，取值在1~38，默认值为18.

​					s:指定小数点右边的最大位数，取值在0~p，默认为0.

### 浮点数据类型

1. float类型

范围：-1.79E+308到1.79E+308之间

格式：float[(n)]

n:科学计数法尾数的位数

| 尾数位数n   | 精度 | 存储字节数 |
| ----------- | ---- | ---------- |
| 1~24        | 7位  | 4          |
| 25~53或省略 | 15位 | 8          |

2. real类型

范围：-3.40E+38到3.40E+38

### 字符数据类型

| 数据类型 | 格式          | 长度范围n（字符数） | 存储字符编码类型 | 数据类型特点                     |
| -------- | ------------- | ------------------- | ---------------- | -------------------------------- |
| char     | char[(n)]     | 1~8000              | 非Unicode        | 占用固定长度（定长）             |
| varchar  | varchar[(n)]  | 1~8000              | 非Unicode        | 占用实际所需的长度（变长）       |
| nchar    | nchar[(n)]    | 1~4000              | Unicode          | 双字节存储、有大量扩展字符       |
| nvarchar | nvarchar[(n)] | 1~4000              | Unicode          | 双字节存储、有大量扩展字符、变长 |
| text     | text[(n)]     | 2<sup>31</sup> -1   | 非Unicode        | 可存储数据量极大                 |
| ntext    | ntext[(n)]    | 2<sup>30</sup> -1   | Unicode          | 可存储数据量极大，字节空间大     |

### 日期和时间数据类型

| 数据类型      | 表示范围                     | 存储大小 | 精确度                 |
| ------------- | ---------------------------- | -------- | ---------------------- |
| datetime      | 1753年1月1日到9999年12月31日 | 8字节    | 三百分之一秒或3.33毫秒 |
| smalldatetime | 1900年1月1日到2079年6月6日   | 4字节    | 分钟                   |

### 图形数据类型

image数据类型用于存储可变长度二进制图形数据，长度介于0到2<sup>31</sup>-1个字节之间。

> image存放的是数据，SQL-Server本身无法查看图片本身，需要借助于其他高级语言来显示图片。

### 货币数据类型

| 数据类型   | 存储大小 | 表示范围                                              | 精确度  |
| ---------- | -------- | ----------------------------------------------------- | ------- |
| money      | 8字节    | -922,337,203,685,477.580,8到922,337,203,685,477.580,7 | 4位小数 |
| smallmoney | 4字节    | -214,748.364,8到214,748.364,7                         | 4位小数 |

### 位数据类型

取值：true 或 false

存储：每8个bit组成的列按一字节存储，不足8个的也按一字节存储

### 二进制数据类型

| 数据类型  | 格式(n:1~8000) | 特点                                                         | 存储大小                       |
| --------- | -------------- | ------------------------------------------------------------ | ------------------------------ |
| binary    | binary[(n)]    | 定义**固定**长度的n字节二进制数据，实际数据长度小于n时余下补0。不指明n时，默认为1. | 实际数据长度加4字节，非n字节。 |
| varbinary | varbinary[(n)] | 定义**可变**长度的n字节二进制数据，实际数据长度小于n时余下补0。不指明n时，默认为1. | 实际数据长度加4字节，非n字节。 |

### 其他数据类型

| 数据类型         | 存储大小 | 特点                                                         |
| ---------------- | -------- | ------------------------------------------------------------ |
| timestamp        | 8字节    | 反映数据库中数据修改的相对顺序，相当于一个单调上升的计数器。常用于处理并发问题。 |
| uniqueidentifier | 16字节   | 全局唯一标识符，每台计算机独特的标识符，任意两台计算机都不会生成重复的值。 |
| sql_variant      | \        | 用于存储除text、ntext、image、timestamp和sql_variant外的所有合法数据。 |
| table            | \        | 用于存储对表或者视图处理后的结果集。                         |
| cursor           | \        | 变量或存储过程中output参数的一种数据类型，参数包含对游标的引用。 |

## 表的创建及约束规则

> 表有两种：**永久表和临时表**。数据通常存在永久表中，除非手动删除，数据和表将永久存在；临时表存储在tampdb中，当重新启动或断开SQL连接时自动删除。临时还可以分为**本地临时表和全局临时表**。本地临时表名称以**#开头**，仅对当前数据库用户可见，其他用户不可见，用户断开数据库连接时，系统自动删除；全局临时表名称以**##开头**，对所有连接数据库用户可见，仅当所有引用该表的用户断开数据库连接时，系统才自动删除。

### 表的创建

~~~sql
create table 表名
(
	列名1 数据类型和长度1 列说明1，
	列名2 数据类型和长度2 列说明2，
	…………
	列名n 数据类型和长度n 列说明n，
)
~~~

参数说明：

1. 列名和表名在数据库中必须唯一。
2. 列说明中：用null表示该字段允许为空，否则用not null；当列的说明为标识列时，用identity（i，j）表示，系统会自动为该列按规律生成值，且唯一，i表示系统生成的初始值，j表示增量。

### 完整性约束

#### 主键约束（只能创建一个）

单字段主键约束：

~~~sql
列名 数据类型及长度 列说明 constraint PK_表名_列名 primary key
~~~

多字段主键约束：

~~~
constraint PK_表名_列名 primary key[(列名1,列名2……列名n)]
~~~

**主键**：用于唯一标识表中的每一条记录，可定义单字段或多字段为主键。*特性*：唯一性（取值不可重复，一般不更新取值），非空性（取值不可为null），外键参照性（取值为外键参照）。

#### 唯一性约束

~~~
列名 数据类型及长度 列说明 constraint IX_表名_列名 unique
或
constraint IX_表名_列名 unique [(列名1,列名2……列名n)]
~~~

唯一性约束用于标识字段的取值不能重复，但可以为null，但只允许一次。

#### 检查约束

检查约束指定表中列的取值可以接受的数据值范围或格式。

~~~
列名 数据类型及长度 列说明 constraint CK_表名_列名 check（列名 逻辑表达式）
或
constraint CK_表名_列名 check（列名 逻辑表达式）
~~~

*逻辑表达式可以使用算术运算符和逻辑运算符*。

逻辑运算符：

1. in关键字：指定列的取值范围为有限的常量。如in（1，2）表示是1或者2。
2. like关键字：模糊匹配通配符：
   1. %：表示任意长度（包括0）的字符串，如%a，以a结尾的任意长度字符串。
   2. _:表示任意单个字符串：如\_a，以a结尾的两字符长度字符串。
   3. []:指定范围或集合中的任何单个字符。如：[0-9]表示在0~9之间的任意一个字符。
   4. [^]:不属于指定范围或集合的任何单个字符。如[^A-Z] 表示不在A-Z之间的任意一个字符。
3. between关键字：设置列的取值在某一数值范围。如between 0 and 800，表示0~800范围。
4. and关键字：同时满足前后两个条件。
5. or关键字：满足前后两个条件之一即可。

#### 默认约束

默认约束为指定列定义一个默认值，默认值可以为常量或null。

~~~
列名 数据类型及长度 列说明 constraint DF_表名_列名 default 常量表达式|null
或
列说明 constraint DF_表名_列名 default 常量表达式|null for 列名
~~~

#### 外键约束

外键约束指外键的取值需要参照主表中主键的取值情况。

~~~
列名 数据类型及长度 列说明 constraint FK_表名_列名 foreign key references 表名（字段名）
或
constraint FK_表名_列名 foreign key（列名） references 表名（字段名）
~~~

**外键**：外键表示两个关系之间的联系。以另一个关系的外键作为主关键词的表称为主表，具有此外键的表称为主表的从表。

> 创建时主键（表）先于外键（表），删除时外键（表）先于主键（表）。约束条件同理。
